var w=[{id:"hearts-ace",label:"A",meta:{suit:"hearts",rank:"A",value:[1,11],color:"red"},char:"\u{1F0B1}"},{id:"hearts-2",label:"2",meta:{suit:"hearts",rank:"2",value:[2],color:"red"},char:"\u{1F0B2}"},{id:"hearts-3",label:"3",meta:{suit:"hearts",rank:"3",value:[3],color:"red"},char:"\u{1F0B3}"},{id:"hearts-4",label:"4",meta:{suit:"hearts",rank:"4",value:[4],color:"red"},char:"\u{1F0B4}"},{id:"hearts-5",label:"5",meta:{suit:"hearts",rank:"5",value:[5],color:"red"},char:"\u{1F0B5}"},{id:"hearts-6",label:"6",meta:{suit:"hearts",rank:"6",value:[6],color:"red"},char:"\u{1F0B6}"},{id:"hearts-7",label:"7",meta:{suit:"hearts",rank:"7",value:[7],color:"red"},char:"\u{1F0B7}"},{id:"hearts-8",label:"8",meta:{suit:"hearts",rank:"8",value:[8],color:"red"},char:"\u{1F0B8}"},{id:"hearts-9",label:"9",meta:{suit:"hearts",rank:"9",value:[9],color:"red"},char:"\u{1F0B9}"},{id:"hearts-10",label:"10",meta:{suit:"hearts",rank:"10",value:[10],color:"red"},char:"\u{1F0BA}"},{id:"hearts-jack",label:"J",meta:{suit:"hearts",rank:"J",value:[10],color:"red"},char:"\u{1F0BB}"},{id:"hearts-queen",label:"Q",meta:{suit:"hearts",rank:"Q",value:[10],color:"red"},char:"\u{1F0BD}"},{id:"hearts-king",label:"K",meta:{suit:"hearts",rank:"K",value:[10],color:"red"},char:"\u{1F0BE}"},{id:"diamonds-ace",label:"A",meta:{suit:"diamonds",rank:"A",value:[1,11],color:"red"},char:"\u{1F0C1}"},{id:"diamonds-2",label:"2",meta:{suit:"diamonds",rank:"2",value:[2],color:"red"},char:"\u{1F0C2}"},{id:"diamonds-3",label:"3",meta:{suit:"diamonds",rank:"3",value:[3],color:"red"},char:"\u{1F0C3}"},{id:"diamonds-4",label:"4",meta:{suit:"diamonds",rank:"4",value:[4],color:"red"},char:"\u{1F0C4}"},{id:"diamonds-5",label:"5",meta:{suit:"diamonds",rank:"5",value:[5],color:"red"},char:"\u{1F0C5}"},{id:"diamonds-6",label:"6",meta:{suit:"diamonds",rank:"6",value:[6],color:"red"},char:"\u{1F0C6}"},{id:"diamonds-7",label:"7",meta:{suit:"diamonds",rank:"7",value:[7],color:"red"},char:"\u{1F0C7}"},{id:"diamonds-8",label:"8",meta:{suit:"diamonds",rank:"8",value:[8],color:"red"},char:"\u{1F0C8}"},{id:"diamonds-9",label:"9",meta:{suit:"diamonds",rank:"9",value:[9],color:"red"},char:"\u{1F0C9}"},{id:"diamonds-10",label:"10",meta:{suit:"diamonds",rank:"10",value:[10],color:"red"},char:"\u{1F0CA}"},{id:"diamonds-jack",label:"J",meta:{suit:"diamonds",rank:"J",value:[10],color:"red"},char:"\u{1F0CB}"},{id:"diamonds-queen",label:"Q",meta:{suit:"diamonds",rank:"Q",value:[10],color:"red"},char:"\u{1F0CD}"},{id:"diamonds-king",label:"K",meta:{suit:"diamonds",rank:"K",value:[10],color:"red"},char:"\u{1F0CE}"},{id:"clubs-ace",label:"A",meta:{suit:"clubs",rank:"A",value:[1,11],color:"black"},char:"\u{1F0D1}"},{id:"clubs-2",label:"2",meta:{suit:"clubs",rank:"2",value:[2],color:"black"},char:"\u{1F0D2}"},{id:"clubs-3",label:"3",meta:{suit:"clubs",rank:"3",value:[3],color:"black"},char:"\u{1F0D3}"},{id:"clubs-4",label:"4",meta:{suit:"clubs",rank:"4",value:[4],color:"black"},char:"\u{1F0D4}"},{id:"clubs-5",label:"5",meta:{suit:"clubs",rank:"5",value:[5],color:"black"},char:"\u{1F0D5}"},{id:"clubs-6",label:"6",meta:{suit:"clubs",rank:"6",value:[6],color:"black"},char:"\u{1F0D6}"},{id:"clubs-7",label:"7",meta:{suit:"clubs",rank:"7",value:[7],color:"black"},char:"\u{1F0D7}"},{id:"clubs-8",label:"8",meta:{suit:"clubs",rank:"8",value:[8],color:"black"},char:"\u{1F0D8}"},{id:"clubs-9",label:"9",meta:{suit:"clubs",rank:"9",value:[9],color:"black"},char:"\u{1F0D9}"},{id:"clubs-10",label:"10",meta:{suit:"clubs",rank:"10",value:[10],color:"black"},char:"\u{1F0DA}"},{id:"clubs-jack",label:"J",meta:{suit:"clubs",rank:"J",value:[10],color:"black"},char:"\u{1F0DB}"},{id:"clubs-queen",label:"Q",meta:{suit:"clubs",rank:"Q",value:[10],color:"black"},char:"\u{1F0DD}"},{id:"clubs-king",label:"K",meta:{suit:"clubs",rank:"K",value:[10],color:"black"},char:"\u{1F0DE}"},{id:"spades-ace",label:"A",meta:{suit:"spades",rank:"A",value:[1,11],color:"black"},char:"\u{1F0A1}"},{id:"spades-2",label:"2",meta:{suit:"spades",rank:"2",value:[2],color:"black"},char:"\u{1F0A2}"},{id:"spades-3",label:"3",meta:{suit:"spades",rank:"3",value:[3],color:"black"},char:"\u{1F0A3}"},{id:"spades-4",label:"4",meta:{suit:"spades",rank:"4",value:[4],color:"black"},char:"\u{1F0A4}"},{id:"spades-5",label:"5",meta:{suit:"spades",rank:"5",value:[5],color:"black"},char:"\u{1F0A5}"},{id:"spades-6",label:"6",meta:{suit:"spades",rank:"6",value:[6],color:"black"},char:"\u{1F0A6}"},{id:"spades-7",label:"7",meta:{suit:"spades",rank:"7",value:[7],color:"black"},char:"\u{1F0A7}"},{id:"spades-8",label:"8",meta:{suit:"spades",rank:"8",value:[8],color:"black"},char:"\u{1F0A8}"},{id:"spades-9",label:"9",meta:{suit:"spades",rank:"9",value:[9],color:"black"},char:"\u{1F0A9}"},{id:"spades-10",label:"10",meta:{suit:"spades",rank:"10",value:[10],color:"black"},char:"\u{1F0AA}"},{id:"spades-jack",label:"J",meta:{suit:"spades",rank:"J",value:[10],color:"black"},char:"\u{1F0AB}"},{id:"spades-queen",label:"Q",meta:{suit:"spades",rank:"Q",value:[10],color:"black"},char:"\u{1F0AD}"},{id:"spades-king",label:"K",meta:{suit:"spades",rank:"K",value:[10],color:"black"},char:"\u{1F0AE}"}];function m(s){if(!s||s.length===0)return[0];let e=0,t=0;for(let r of s){let i=r.meta?.value||[0];i.length>1?(t++,e+=1):e+=i[0]}let a=[e];for(let r=0;r<t;r++){let i=e+10*(r+1);i<=21&&a.push(i)}return a}function u(s){let e=m(s),t=e.filter(a=>a<=21);return t.length===0?Math.min(...e):Math.max(...t)}function d(s){return m(s).every(t=>t>21)}function h(s){return s.length!==2?!1:m(s).includes(21)}function B(s){let e=m(s),t=u(s);return t>21?!1:e.length>1&&e.includes(t)}function k(s,e=!1){if(!s||s.length===0)return"Empty hand";let t=s.map((l,n)=>e&&n===0?"[Hidden]":`${l.char} ${l.label}`);if(e){let l=s.slice(1),n=u(l);return`${t.join(", ")} (showing: ${n})`}let a=u(s),i=B(s)?`soft ${a}`:a;return`${t.join(", ")} (${i})`}function S(s,e){let t=u(s),a=u(e),r=h(s),i=h(e);return r&&i?"push":r?"agent-blackjack":i||t>21?"dealer":a>21||t>a?"agent":a>t?"dealer":"push"}function b(s){return s.length===2&&!d(s)}function p(s){if(s.length!==2)return!1;let e=s[0].meta?.rank,t=s[1].meta?.rank;return e===t}function C(s){return!s||s.length===0?!1:(s.length>1?s[1]:s[0]).meta?.rank==="A"}function F(s){if(s.length!==2)return{isPair:!1,type:null,payout:0};let e=s[0],t=s[1],a=e.meta.rank,r=t.meta.rank,i=e.meta.suit,l=t.meta.suit,n=e.meta.color,c=t.meta.color;return a!==r?{isPair:!1,type:null,payout:0}:i===l?{isPair:!0,type:"perfect",payout:30}:n===c?{isPair:!0,type:"colored",payout:10}:{isPair:!0,type:"mixed",payout:5}}function A(s,e){if(s.length!==2||!e)return{hasWin:!1,type:null,payout:0};let t=[...s,e],a=t.map(o=>o.meta.rank),r=t.map(o=>o.meta.suit),i={A:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10,J:11,Q:12,K:13},n=[...a.map(o=>i[o]||0)].sort((o,v)=>o-v),c=r.every(o=>o===r[0]),f=a.every(o=>o===a[0]),H=n[1]===n[0]+1&&n[2]===n[1]+1||n[0]===1&&n[1]===12&&n[2]===13;return f&&c?{hasWin:!0,type:"suited-three-of-kind",payout:100}:H&&c?{hasWin:!0,type:"straight-flush",payout:40}:f?{hasWin:!0,type:"three-of-kind",payout:30}:H?{hasWin:!0,type:"straight",payout:10}:c?{hasWin:!0,type:"flush",payout:5}:{hasWin:!1,type:null,payout:0}}function O(s,e=!1){if(s.length!==2)return{hasWin:!1,type:null,payout:0};if(u(s)!==20)return{hasWin:!1,type:null,payout:0};let a=s[0],r=s[1],i=a.meta.rank==="Q"&&a.meta.suit==="hearts",l=r.meta.rank==="Q"&&r.meta.suit==="hearts";return i&&l&&e?{hasWin:!0,type:"queen-hearts-pair-bj",payout:1e3}:i&&l?{hasWin:!0,type:"queen-hearts-pair",payout:125}:a.meta.rank===r.meta.rank&&a.meta.suit===r.meta.suit?{hasWin:!0,type:"matched-20",payout:19}:a.meta.suit===r.meta.suit?{hasWin:!0,type:"suited-20",payout:9}:{hasWin:!0,type:"any-20",payout:4}}function P(s){if(!d(s))return{hasWin:!1,type:null,payout:0};let e=s.length;return e>=8?{hasWin:!0,type:"8-plus-cards",payout:250}:e===7?{hasWin:!0,type:"7-cards",payout:100}:e===6?{hasWin:!0,type:"6-cards",payout:50}:e===5?{hasWin:!0,type:"5-cards",payout:12}:e===4?{hasWin:!0,type:"4-cards",payout:4}:{hasWin:!0,type:"3-cards",payout:2}}var g=class{constructor(e){this.seed=e??Date.now()}next(){return this.seed=this.seed*1103515245+12345&2147483647,this.seed/2147483647}},y=class{constructor({numDecks:e=6,seed:t=null,initialBankroll:a=1e3,minBet:r=5,maxBet:i=500,variant:l="american",dealerHitsSoft17:n=!1,allowSurrender:c=!1,resplitAces:f=!0}={}){this.variant=l,this.numDecks=e,this.minBet=r,this.maxBet=i,this.dealerHitsSoft17=n,this.allowSurrender=c,this.resplitAces=f,this.random=new g(t),this.shoe=[],this.initializeShoe(),this.bankroll=a,this.currentBet=0,this.playerHand=[],this.dealerHand=[],this.splitHands=[],this.splitBets=[],this.splitFromAces=!1,this.currentSplitHandIndex=-1,this.cutCardPosition=Math.floor(52*1.5),this.cutCardReached=!1,this.gameState={dealerTurn:!1,gameOver:!1,playerStood:!1,result:null,insuranceOffered:!1,insuranceTaken:!1,insuranceBet:0},this.perfectPairsBet=0,this.twentyOnePlus3Bet=0,this.luckyLadiesBet=0,this.busterBlackjackBet=0,this.sideBetResults=null,this.shuffle(),this.needsBurn=!0,this.burnedCard=null,this.runningCount=0}placePerfectPairsBet(e){if(e>this.bankroll)throw new Error(`Insufficient funds for Perfect Pairs bet. Bankroll: ${this.bankroll}`);return this.bankroll-=e,this.perfectPairsBet=e,this.bankroll}place21Plus3Bet(e){if(e>this.bankroll)throw new Error(`Insufficient funds for 21+3 bet. Bankroll: ${this.bankroll}`);return this.bankroll-=e,this.twentyOnePlus3Bet=e,this.bankroll}placeLuckyLadiesBet(e){if(e>this.bankroll)throw new Error(`Insufficient funds for Lucky Ladies bet. Bankroll: ${this.bankroll}`);return this.bankroll-=e,this.luckyLadiesBet=e,this.bankroll}placeBusterBlackjackBet(e){if(e>this.bankroll)throw new Error(`Insufficient funds for Buster Blackjack bet. Bankroll: ${this.bankroll}`);return this.bankroll-=e,this.busterBlackjackBet=e,this.bankroll}resolveSideBets(){if(this.playerHand.length!==2)return null;let e={perfectPairs:null,twentyOnePlus3:null};if(this.perfectPairsBet>0){let t=F(this.playerHand);if(t.isPair){let a=this.perfectPairsBet*t.payout+this.perfectPairsBet;this.bankroll+=a,e.perfectPairs={win:!0,type:t.type,multiplier:t.payout,payout:a}}else e.perfectPairs={win:!1,type:null,payout:0};this.perfectPairsBet=0}if(this.twentyOnePlus3Bet>0){let t=this.variant==="european"?this.dealerHand[0]:this.dealerHand[1],a=A(this.playerHand,t);if(a.hasWin){let r=this.twentyOnePlus3Bet*a.payout+this.twentyOnePlus3Bet;this.bankroll+=r,e.twentyOnePlus3={win:!0,type:a.type,multiplier:a.payout,payout:r}}else e.twentyOnePlus3={win:!1,type:null,payout:0};this.twentyOnePlus3Bet=0}return this.sideBetResults=e,e}resolveDealerDependentSideBets(){let e={luckyLadies:null,busterBlackjack:null};if(this.luckyLadiesBet>0){let t=h(this.dealerHand),a=O(this.playerHand,t);if(a.hasWin){let r=this.luckyLadiesBet*a.payout+this.luckyLadiesBet;this.bankroll+=r,e.luckyLadies={win:!0,type:a.type,multiplier:a.payout,payout:r}}else e.luckyLadies={win:!1,type:null,payout:0};this.luckyLadiesBet=0}if(this.busterBlackjackBet>0){let t=P(this.dealerHand);if(t.hasWin){let a=this.busterBlackjackBet*t.payout+this.busterBlackjackBet;this.bankroll+=a,e.busterBlackjack={win:!0,type:t.type,multiplier:t.payout,payout:a}}else e.busterBlackjack={win:!1,type:null,payout:0};this.busterBlackjackBet=0}return this.sideBetResults?this.sideBetResults={...this.sideBetResults,...e}:this.sideBetResults=e,e}initializeShoe(){this.shoe=[];for(let e=0;e<this.numDecks;e++)for(let t of w)this.shoe.push({...t,id:`${t.id}-${e}`,faceUp:!0})}shuffle(){for(let e=this.shoe.length-1;e>0;e--){let t=Math.floor(this.random.next()*(e+1));[this.shoe[e],this.shoe[t]]=[this.shoe[t],this.shoe[e]]}this.needsBurn=!0,this.runningCount=0}getCardCountValue(e){let t=e.meta?.rank;return["2","3","4","5","6"].includes(t)?1:["10","J","Q","K","A"].includes(t)?-1:0}countCard(e){this.runningCount+=this.getCardCountValue(e)}getRunningCount(){return this.runningCount}getTrueCount(){let e=this.shoe.length/52;return e<.5?this.runningCount:Math.round(this.runningCount/e*10)/10}getCountInfo(){return{runningCount:this.runningCount,trueCount:this.getTrueCount(),decksRemaining:Math.round(this.shoe.length/52*10)/10,cardsDealt:this.numDecks*52-this.shoe.length}}shouldBurnCard(){return this.needsBurn}burnCard(){if(!this.needsBurn)return null;let e=this.shoe.pop();return this.countCard(e),this.burnedCard={...e,faceUp:!1},this.needsBurn=!1,this.burnedCard}getBurnedCard(){return this.burnedCard}draw(){this.shoe.length===0&&(this.initializeShoe(),this.shuffle()),this.shoe.length<=this.cutCardPosition&&!this.cutCardReached&&(this.cutCardReached=!0);let e=this.shoe.pop();return this.countCard(e),e}shouldReshuffle(){return this.cutCardReached}reshuffle(){this.initializeShoe(),this.shuffle(),this.cutCardReached=!1}placeBet(e){if(e<this.minBet||e>this.maxBet)throw new Error(`Bet must be between ${this.minBet} and ${this.maxBet}`);if(e>this.bankroll)throw new Error(`Insufficient funds. Bankroll: ${this.bankroll}`);return this.currentBet=e,this.bankroll-=e,this.bankroll}deal(){return this.playerHand=[],this.dealerHand=[],this.splitHands=[],this.splitBets=[],this.currentSplitHandIndex=-1,this.gameState={dealerTurn:!1,gameOver:!1,playerStood:!1,result:null,insuranceOffered:!1,insuranceTaken:!1,insuranceBet:0},this.sideBetResults=null,this.playerHand.push(this.draw()),this.playerHand.push(this.draw()),this.variant==="european"?this.dealerHand.push({...this.draw(),faceUp:!0}):(this.dealerHand.push({...this.draw(),faceUp:!1}),this.dealerHand.push({...this.draw(),faceUp:!0})),this.variant==="american"&&C(this.dealerHand)&&(this.gameState.insuranceOffered=!0),h(this.playerHand)&&this.standAndResolve(),this.getGameState()}hit(){if(this.gameState.gameOver)throw new Error("Game is over. Start a new round.");if(this.gameState.playerStood)throw new Error("Player has already stood.");return this.splitHands.length>0&&this.currentSplitHandIndex>=0?this.hitSplitHand(this.currentSplitHandIndex):(this.playerHand.push(this.draw()),d(this.playerHand)&&(this.gameState.gameOver=!0,this.gameState.result="dealer"),this.getGameState())}stand(){if(this.gameState.gameOver)throw new Error("Game is over. Start a new round.");if(this.gameState.playerStood)throw new Error("Player has already stood.");return this.splitHands.length>0&&this.currentSplitHandIndex>=0?this.standSplitHand(this.currentSplitHandIndex):(this.standAndResolve(),this.getGameState())}standAndResolve(){this.gameState.playerStood=!0,this.gameState.dealerTurn=!0,this.variant==="european"?this.dealerHand.push({...this.draw(),faceUp:!0}):this.dealerHand[0]&&(this.dealerHand[0].faceUp=!0),this.gameState.insuranceTaken&&this.resolveInsurance(),this.playDealerHand()}doubleDown(){if(this.gameState.gameOver)throw new Error("Game is over. Start a new round.");if(this.gameState.playerStood)throw new Error("Player has already stood.");let e=this.splitHands.length>0?this.splitHands[this.currentSplitHandIndex]:this.playerHand;if(!b(e))throw new Error("Cannot double down - must have exactly 2 cards.");if(this.bankroll<this.currentBet)throw new Error("Insufficient funds to double down.");return this.bankroll-=this.currentBet,this.splitHands.length>0?this.splitBets[this.currentSplitHandIndex]*=2:this.currentBet*=2,this.splitHands.length>0?(this.splitHands[this.currentSplitHandIndex].push(this.draw()),this.advanceToNextSplitHand(),this.getSplitGameState()):(this.playerHand.push(this.draw()),d(this.playerHand)?(this.gameState.gameOver=!0,this.gameState.result="dealer"):this.standAndResolve(),this.getGameState())}split(){if(this.gameState.gameOver)throw new Error("Game is over. Start a new round.");if(this.gameState.playerStood)throw new Error("Player has already stood.");if(!p(this.playerHand))throw new Error("Cannot split - must have exactly 2 cards of the same rank.");if(this.bankroll<this.currentBet)throw new Error("Insufficient funds to split.");let e=this.playerHand[0].meta.rank==="A";return this.bankroll-=this.currentBet,this.splitHands=[[this.playerHand[0]],[this.playerHand[1]]],this.splitBets=[this.currentBet,this.currentBet],this.splitFromAces=e,this.currentSplitHandIndex=0,this.splitHands[0].push(this.draw()),this.splitHands[1].push(this.draw()),this.playerHand=[],e&&(this.currentSplitHandIndex=-1,this.resolveSplitHands()),this.getSplitGameState()}hitSplitHand(e){if(e>=this.splitHands.length)throw new Error(`Invalid hand index: ${e}`);if(this.splitFromAces)throw new Error("Cannot hit on split aces - one card only.");return this.splitHands[e].push(this.draw()),d(this.splitHands[e])&&this.advanceToNextSplitHand(),this.getSplitGameState()}standSplitHand(e){if(e>=this.splitHands.length)throw new Error(`Invalid hand index: ${e}`);return this.advanceToNextSplitHand(),this.getSplitGameState()}advanceToNextSplitHand(){this.currentSplitHandIndex++,this.currentSplitHandIndex>=this.splitHands.length&&(this.currentSplitHandIndex=-1,this.resolveSplitHands())}resolveSplitHands(){this.gameState.dealerTurn=!0,this.variant==="european"?this.dealerHand.push({...this.draw(),faceUp:!0}):this.dealerHand[0]&&(this.dealerHand[0].faceUp=!0),this.playDealerHand();let e=[],t=0;for(let a=0;a<this.splitHands.length;a++){let r=this.splitHands[a],i=this.splitBets[a],l;d(r)?l="dealer":(l=S(r,this.dealerHand),l==="agent-blackjack"&&this.splitFromAces&&(l="agent")),e.push({handIndex:a,result:l,cards:r,value:u(r),busted:d(r)}),l==="agent-blackjack"||l==="agent"?t+=i*2:l==="push"&&(t+=i)}this.bankroll+=t,this.gameState.gameOver=!0,this.gameState.splitResults=e}reSplit(e){if(this.splitHands.length>=4)throw new Error("Maximum 4 hands reached. Cannot split further.");let t=this.splitHands[e];if(!p(t))throw new Error("Cannot re-split - must have exactly 2 cards of the same rank.");if(this.bankroll<this.currentBet)throw new Error("Insufficient funds to re-split.");this.bankroll-=this.currentBet;let a=[t.pop()];return a.push(this.draw()),t.push(this.draw()),this.splitHands.splice(e+1,0,a),this.splitBets.splice(e+1,0,this.currentBet),this.getSplitGameState()}takeInsurance(e=null){if(this.variant==="european")throw new Error("Insurance not available in European blackjack variant.");if(!this.gameState.insuranceOffered)throw new Error("Insurance not available.");if(this.gameState.insuranceTaken)throw new Error("Insurance already taken.");let t=e!==null?e:this.currentBet/2;if(t>this.currentBet/2)throw new Error(`Insurance bet cannot exceed half of original bet ($${this.currentBet/2})`);if(t>this.bankroll)throw new Error(`Insufficient funds for insurance. Bankroll: ${this.bankroll}`);return this.bankroll-=t,this.gameState.insuranceBet=t,this.gameState.insuranceTaken=!0,this.getGameState()}checkDealerBlackjack(){return this.variant!=="american"?{dealerHasBlackjack:!1,...this.getGameState()}:this.gameState.insuranceOffered?(this.gameState.insuranceOffered=!1,h(this.dealerHand)?(this.dealerHand[0]&&(this.dealerHand[0].faceUp=!0),this.gameState.insuranceTaken&&this.gameState.insuranceBet>0&&(this.bankroll+=this.gameState.insuranceBet*3,this.gameState.insuranceBet=0),h(this.playerHand)?(this.bankroll+=this.currentBet,this.gameState.result="push"):this.gameState.result="dealer",this.gameState.gameOver=!0,{dealerHasBlackjack:!0,...this.getGameState()}):(this.gameState.insuranceBet=0,{dealerHasBlackjack:!1,...this.getGameState()})):{dealerHasBlackjack:!1,...this.getGameState()}}declineInsurance(){if(!this.gameState.insuranceOffered)throw new Error("Insurance not available.");return this.gameState.insuranceOffered=!1,h(this.dealerHand)?(this.dealerHand[0]&&(this.dealerHand[0].faceUp=!0),h(this.playerHand)?(this.bankroll+=this.currentBet,this.gameState.result="push"):this.gameState.result="dealer",this.gameState.gameOver=!0,{dealerHasBlackjack:!0,...this.getGameState()}):{dealerHasBlackjack:!1,...this.getGameState()}}resolveInsurance(){this.gameState.insuranceBet&&(h(this.dealerHand)&&(this.bankroll+=this.gameState.insuranceBet*3),this.gameState.insuranceBet=0)}surrender(){if(!this.allowSurrender)throw new Error("Surrender is not allowed.");if(this.gameState.gameOver)throw new Error("Game is over. Start a new round.");if(this.gameState.playerStood)throw new Error("Player has already stood.");if(this.playerHand.length!==2)throw new Error("Surrender only available on first two cards.");if(this.splitHands.length>0)throw new Error("Cannot surrender after splitting.");return this.bankroll+=this.currentBet/2,this.gameState.gameOver=!0,this.gameState.result="surrender",this.getGameState()}canSurrender(){return this.allowSurrender&&!this.gameState.gameOver&&!this.gameState.playerStood&&this.playerHand.length===2&&this.splitHands.length===0}playDealerHand(){let e=u(this.dealerHand);for(;e<17||this.dealerHitsSoft17&&e===17&&B(this.dealerHand);)this.dealerHand.push({...this.draw(),faceUp:!0}),e=u(this.dealerHand);if(this.gameState.dealerTurn=!1,this.gameState.gameOver=!0,this.splitHands.length===0){this.gameState.result=S(this.playerHand,this.dealerHand);let t=0;this.gameState.result==="agent-blackjack"?t=this.currentBet+this.currentBet*1.5:this.gameState.result==="agent"?t=this.currentBet*2:this.gameState.result==="push"&&(t=this.currentBet),this.bankroll+=t}}getGameState(){let e=this.gameState.gameOver||this.gameState.dealerTurn,t=this.dealerHand.filter((r,i)=>e?!0:r.faceUp),a=!this.gameState.gameOver&&!this.gameState.playerStood&&!d(this.playerHand)&&!h(this.playerHand)&&this.splitHands.length===0;return{playerHand:{cards:this.playerHand,value:u(this.playerHand),busted:d(this.playerHand),blackjack:h(this.playerHand),display:k(this.playerHand)},dealerHand:{cards:this.dealerHand,visibleCards:e?this.dealerHand:t,value:e?u(this.dealerHand):null,visibleValue:u(t),busted:e?d(this.dealerHand):null,blackjack:e?h(this.dealerHand):null,display:k(this.dealerHand,!e)},bankroll:this.bankroll,currentBet:this.currentBet,gameOver:this.gameState.gameOver,result:this.gameState.result,canHit:a,canStand:a,canDouble:a&&b(this.playerHand)&&this.bankroll>=this.currentBet,canSplit:a&&p(this.playerHand)&&this.bankroll>=this.currentBet&&this.splitHands.length===0,canSurrender:this.canSurrender(),canInsurance:this.variant==="american"&&this.playerHand.length===2&&!this.gameState.insuranceTaken&&this.gameState.insuranceOffered,variant:this.variant,isSplit:this.splitHands.length>0,deckCount:this.shoe.length,needsBurn:this.needsBurn,burnedCard:this.burnedCard,sideBetResults:this.sideBetResults,pendingSideBets:{perfectPairs:this.perfectPairsBet,twentyOnePlus3:this.twentyOnePlus3Bet,luckyLadies:this.luckyLadiesBet,busterBlackjack:this.busterBlackjackBet},cutCardReached:this.cutCardReached,countInfo:this.getCountInfo()}}getSplitGameState(){let e=this.gameState.gameOver||this.gameState.dealerTurn,t=this.dealerHand.filter((n,c)=>e?!0:n.faceUp),a=this.splitHands.map((n,c)=>({cards:n,value:u(n),busted:d(n),blackjack:h(n),display:k(n),active:c===this.currentSplitHandIndex,canReSplit:p(n)&&this.splitHands.length<4&&this.bankroll>=this.currentBet&&(this.resplitAces||n[0].meta.rank!=="A")})),r=this.currentSplitHandIndex>=0?this.splitHands[this.currentSplitHandIndex]:null,i=!this.gameState.gameOver&&this.currentSplitHandIndex>=0&&r&&!d(r),l=i&&!this.splitFromAces;return{splitHands:a,splitFromAces:this.splitFromAces,dealerHand:{cards:this.dealerHand,visibleCards:e?this.dealerHand:t,value:e?u(this.dealerHand):null,visibleValue:u(t),busted:e?d(this.dealerHand):null,blackjack:e?h(this.dealerHand):null,display:k(this.dealerHand,!e)},bankroll:this.bankroll,currentBet:this.currentBet,currentHand:this.currentSplitHandIndex,splitHandsCount:this.splitHands.length,gameOver:this.gameState.gameOver,results:this.gameState.splitResults||[],canHit:l,canStand:i,canDouble:l&&r&&b(r)&&this.bankroll>=this.currentBet,canReSplit:i&&r&&p(r)&&this.splitHands.length<4&&this.bankroll>=this.currentBet&&(this.resplitAces||r[0].meta.rank!=="A"),variant:this.variant,deckCount:this.shoe.length,cutCardReached:this.cutCardReached,countInfo:this.getCountInfo()}}getResultMessage(){let e=this.gameState.result;if(!e)return null;switch(e){case"agent-blackjack":return"BLACKJACK! You win 3:2!";case"agent":return"You win!";case"dealer":return"Dealer wins.";case"push":return"Push - tie game.";default:return null}}newRound(){return this.shoe.length<52&&(this.initializeShoe(),this.shuffle()),this.currentBet>this.bankroll&&(this.currentBet=this.bankroll),this.deal()}isBroke(){return this.bankroll<this.minBet}};typeof window<"u"&&(window.BlackjackGame=y);export{y as BlackjackGame};
