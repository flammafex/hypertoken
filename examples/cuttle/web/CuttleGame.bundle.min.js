var I=Object.defineProperty;var w=(p,t,e)=>t in p?I(p,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):p[t]=e;var v=(p,t,e)=>w(p,typeof t!="symbol"?t+"":t,e);var T=["clubs","diamonds","hearts","spades"],J=["A","2","3","4","5","6","7","8","9","10","J","Q","K"];var _=[14,10,7,5],A=[14,10,5,0],R=[9,5,0];function P(p){return p==="A"?1:p==="J"?11:p==="Q"?12:p==="K"?13:parseInt(p)}function b(p){let t=P(p);return t<=10?t:0}function $(p){return T.indexOf(p)}function C(p,t){let e=P(p.rank),s=P(t.rank);return e>s?!0:e===s?$(p.suit)>$(t.suit):!1}function y(p){let t=P(p);return t>=1&&t<=10}function f(p){return`${p.rank}${p.suit[0].toUpperCase()}`}var m=class{constructor(t){v(this,"seed");this.seed=t??Date.now()}next(){return this.seed=this.seed*1103515245+12345&2147483647,this.seed/2147483647}shuffle(t){let e=[...t];for(let s=e.length-1;s>0;s--){let n=Math.floor(this.next()*(s+1));[e[s],e[n]]=[e[n],e[s]]}return e}},O=class{constructor(t={}){v(this,"config");v(this,"rng");v(this,"state");let e=t.variant??"classic",s=e==="cutthroat"?7:8;this.config={seed:t.seed??null,handLimit:t.handLimit??s,variant:e},this.rng=new m(this.config.seed??void 0),this.state=this.createInitialState()}get variant(){return this.config.variant}reset(t){t!==void 0?this.rng=new m(t):this.config.seed!==null?this.rng=new m(this.config.seed):this.rng=new m,this.state=this.createInitialState()}createInitialState(){let t=[],e=0;for(let a of T)for(let i of J)t.push({rank:i,suit:a,id:e++});this.config.variant==="cutthroat"&&(t.push({rank:"A",suit:"hearts",id:e++,isJoker:!0}),t.push({rank:"A",suit:"spades",id:e++,isJoker:!0}));let s=this.rng.shuffle(t),n=this.config.variant==="cutthroat"?3:2,r=[];for(let a=0;a<n;a++)r.push({hand:[],pointCards:[],permanents:[]});if(this.config.variant==="cutthroat")for(let a=0;a<5;a++)for(let i=0;i<3;i++)r[i].hand.push(s.pop());else{for(let a=0;a<5;a++)r[1].hand.push(s.pop());for(let a=0;a<6;a++)r[0].hand.push(s.pop())}return{players:r,deck:s,scrap:[],currentPlayer:1,phase:"play",pendingOneOff:null,sevenDrawnCard:null,sevenRevealedCards:null,fiveDiscardPending:!1,frozenCardIds:[],discardCount:0,discardingPlayer:null,skipTurnPlayers:[],consecutivePasses:0,winner:null,isDraw:!1,lastAction:null,turnNumber:0}}getState(){return JSON.parse(JSON.stringify(this.state))}getPointGoal(t){let e=this.state.players[t].permanents.filter(r=>r.type==="king").length,s=this.config.variant==="cutthroat"?14:21;if(e===0)return s;let n;return this.config.variant==="cutthroat"?n=R:this.config.variant==="standard"?n=A:n=_,n[Math.min(e-1,n.length-1)]}getPoints(t){let e=0;for(let s of this.state.players)for(let n of s.pointCards)n.controller===t&&(e+=b(n.card.rank));return e}isProtected(t,e){let n=this.state.players[t].permanents.filter(a=>a.type==="queen");return!(n.length===0||n.some(a=>a.card.id===e)&&n.length===1)}getObservation(t){let e=this.state.players[t],s=this.state.players.length,n=e.permanents.some(d=>d.type==="eight"),r=[];for(let d=0;d<s;d++){if(d===t)continue;let h=this.state.players[d];r.push({playerIndex:d,handSize:h.hand.length,hand:n?h.hand:null,pointCards:h.pointCards,permanents:h.permanents,points:this.getPoints(d),goal:this.getPointGoal(d)})}let a=s===2?1-t:(t+1)%s,i=this.state.players[a];return{myHand:e.hand,myPointCards:e.pointCards,myPermanents:e.permanents,myPoints:this.getPoints(t),myGoal:this.getPointGoal(t),opponents:r,opponentHandSize:i.hand.length,opponentHand:n?i.hand:null,opponentPointCards:i.pointCards,opponentPermanents:i.permanents,opponentPoints:this.getPoints(a),opponentGoal:this.getPointGoal(a),deckSize:this.state.deck.length,scrap:this.state.scrap,currentPlayer:this.state.currentPlayer,phase:this.state.phase,pendingOneOff:this.state.pendingOneOff,sevenDrawnCard:this.state.phase==="resolve_seven"&&this.state.currentPlayer===t?this.state.sevenDrawnCard:null,sevenRevealedCards:this.state.phase==="resolve_seven_choose"&&this.state.currentPlayer===t?this.state.sevenRevealedCards:null,fiveDiscardPending:this.state.fiveDiscardPending,frozenCardIds:this.state.frozenCardIds,discardCount:this.state.discardCount,discardingPlayer:this.state.discardingPlayer,skipTurnPlayers:this.state.skipTurnPlayers,consecutivePasses:this.state.consecutivePasses,winner:this.state.winner,isDraw:this.state.isDraw,lastAction:this.state.lastAction,variant:this.config.variant,numPlayers:s}}get numPlayers(){return this.config.variant==="cutthroat"?3:2}isCardFrozen(t){return this.config.variant==="classic"?!1:this.state.frozenCardIds.includes(t)}getAdjacentPlayers(t){let e=this.state.players.length;return e===2?[1-t]:e===3?[0,1,2].filter(s=>s!==t):[(t+1)%e,(t+e-1)%e]}isJoker(t){return t.isJoker===!0}getJokerTargets(t){let e=[];for(let s=0;s<this.state.players.length;s++){if(s===t)continue;let n=this.state.players[s];for(let r of n.permanents)(r.type==="queen"||r.type==="king")&&(this.isProtected(s,r.card.id)||e.push({card:r.card,owner:s,type:"permanent"}))}for(let s of this.state.players)for(let n of s.pointCards)for(let r of n.attachedJacks){let a=this.getJackController(n,r);a!==t&&!this.isProtected(a,r.id)&&e.push({card:r,owner:a,type:"jack"})}return e}getTargetablePointCards(t){let e=[];for(let s of this.state.players)for(let n of s.pointCards)n.controller===t&&(this.isProtected(t,n.card.id)||e.push(n));return e}getTargetablePermanents(t){return this.state.players[t].permanents.filter(e=>!this.isProtected(t,e.card.id))}getValidActions(t){let e=[],s=this.state.players[t],n=this.state.players.length;if(this.state.winner!==null||this.state.isDraw)return[];switch(this.state.phase){case"play":if(t!==this.state.currentPlayer)return[];this.state.deck.length>0&&s.hand.length<this.config.handLimit&&e.push("draw"),this.state.deck.length===0&&e.push("pass");for(let o of s.hand)if(!this.isCardFrozen(o.id)){if(this.isJoker(o)){let c=this.getJokerTargets(t);for(let l of c)e.push(`joker:${o.id}:${l.card.id}`);continue}switch(y(o.rank)&&e.push(`point:${o.id}`),o.rank){case"A":this.getAllPointCardsInPlay().length>0&&e.push(`oneoff:${o.id}`);break;case"2":for(let c of this.state.players)for(let l of c.permanents)this.isProtected(this.state.players.indexOf(c),l.card.id)||e.push(`oneoff:${o.id}:permanent:${l.card.id}`);for(let c of this.state.players)for(let l of c.pointCards)for(let u of l.attachedJacks){let g=this.getJackController(l,u);this.isProtected(g,u.id)||e.push(`oneoff:${o.id}:permanent:${u.id}`)}break;case"3":this.state.scrap.length>0&&e.push(`oneoff:${o.id}`);break;case"4":if(n===2)this.state.players[1-t].hand.length>0&&e.push(`oneoff:${o.id}`);else for(let c=0;c<n;c++)c!==t&&this.state.players[c].hand.length>0&&e.push(`oneoff:${o.id}:target:${c}`);break;case"5":this.state.deck.length>0&&e.push(`oneoff:${o.id}`);break;case"6":this.getAllPermanentsInPlay().length>0&&e.push(`oneoff:${o.id}`);break;case"7":this.state.deck.length>0&&e.push(`oneoff:${o.id}`);break;case"9":for(let c of this.state.players){let l=this.state.players.indexOf(c);for(let u of c.permanents)this.isProtected(l,u.card.id)||e.push(`oneoff:${o.id}:card:${u.card.id}`);for(let u of c.pointCards){for(let g of u.attachedJacks){let k=this.getJackController(u,g);this.isProtected(k,g.id)||e.push(`oneoff:${o.id}:card:${g.id}`)}this.config.variant==="classic"&&(this.isProtected(u.controller,u.card.id)||e.push(`oneoff:${o.id}:card:${u.card.id}`))}}break}switch(o.rank){case"8":e.push(`permanent:${o.id}`);break;case"J":if(this.config.variant==="cutthroat"){let c=this.getAdjacentPlayers(t);for(let l of c)for(let u of this.getTargetablePointCards(l))e.push(`permanent:${o.id}:${u.card.id}`);for(let l of s.pointCards)l.controller!==t&&c.includes(l.controller)&&(this.isProtected(l.controller,l.card.id)||e.push(`permanent:${o.id}:${l.card.id}`))}else{for(let c of this.getTargetablePointCards(1-t))e.push(`permanent:${o.id}:${c.card.id}`);for(let c of s.pointCards)c.controller!==t&&!this.isProtected(c.controller,c.card.id)&&e.push(`permanent:${o.id}:${c.card.id}`)}break;case"Q":case"K":e.push(`permanent:${o.id}`);break}if(y(o.rank)){for(let c=0;c<n;c++){if(c===t)continue;let l=this.state.players[c];for(let u of l.pointCards)u.controller===c&&C(o,u.card)&&e.push(`scuttle:${o.id}:${u.card.id}`)}for(let c of s.pointCards)c.controller!==t&&C(o,c.card)&&e.push(`scuttle:${o.id}:${c.card.id}`)}}break;case"counter":if(!this.state.pendingOneOff)return[];let r=this.state.pendingOneOff.player,a;if(this.state.pendingOneOff.counterChain.length%2===0?this.state.pendingOneOff.targetPlayer!==void 0?a=this.state.pendingOneOff.targetPlayer:this.state.pendingOneOff.target?(a=this.findCardOwner(this.state.pendingOneOff.target.cardId),a===-1&&(a=(r+1)%n)):n===2?a=1-r:a=(r+1)%n:a=r,t!==a)return[];for(let o of s.hand)o.rank==="2"&&e.push(`counter:${o.id}`);e.push("pass");break;case"resolve_three":if(t!==this.state.currentPlayer)return[];for(let o of this.state.scrap)e.push(`choose:${o.id}`);break;case"resolve_four":let i=this.state.discardingPlayer??1-this.state.currentPlayer;if(t!==i)return[];for(let o of s.hand)e.push(`discard:${o.id}`);break;case"resolve_five_discard":if(t!==this.state.currentPlayer)return[];for(let o of s.hand)e.push(`five_discard:${o.id}`);break;case"resolve_seven":if(t!==this.state.currentPlayer)return[];if(!this.state.sevenDrawnCard)return[];let d=this.state.sevenDrawnCard,h=this.getSevenPlayActions(t,d);h.length===0?e.push("scrap_seven"):e.push(...h);break;case"resolve_seven_choose":if(t!==this.state.currentPlayer)return[];if(!this.state.sevenRevealedCards||this.state.sevenRevealedCards.length===0)return[];for(let o of this.state.sevenRevealedCards){let c=this.getSevenPlayActions(t,o);c.length>0&&e.push(...c)}if(e.length===0&&this.state.sevenRevealedCards.length>0)for(let o of this.state.sevenRevealedCards)e.push(`scrap_seven:${o.id}`);break;case"resolve_nine":break}return e}getSevenPlayActions(t,e){let s=[],n=this.state.players[1-t];if(this.isJoker(e)){let r=this.getJokerTargets(t);for(let a of r)s.push(`seven_joker:${e.id}:${a.card.id}`);return s}switch(y(e.rank)&&s.push(`seven_point:${e.id}`),e.rank){case"A":this.getAllPointCardsInPlay().length>0&&s.push(`seven_oneoff:${e.id}`);break;case"2":for(let r of this.state.players)for(let a of r.permanents)this.isProtected(this.state.players.indexOf(r),a.card.id)||s.push(`seven_oneoff:${e.id}:permanent:${a.card.id}`);for(let r of this.state.players)for(let a of r.pointCards)for(let i of a.attachedJacks){let d=this.getJackController(a,i);this.isProtected(d,i.id)||s.push(`seven_oneoff:${e.id}:permanent:${i.id}`)}break;case"3":this.state.scrap.length>0&&s.push(`seven_oneoff:${e.id}`);break;case"4":n.hand.length>0&&s.push(`seven_oneoff:${e.id}`);break;case"5":this.state.deck.length>0&&s.push(`seven_oneoff:${e.id}`);break;case"6":this.getAllPermanentsInPlay().length>0&&s.push(`seven_oneoff:${e.id}`);break;case"7":this.state.deck.length>0&&s.push(`seven_oneoff:${e.id}`);break;case"9":for(let r of this.state.players){let a=this.state.players.indexOf(r);for(let i of r.permanents)this.isProtected(a,i.card.id)||s.push(`seven_oneoff:${e.id}:card:${i.card.id}`);for(let i of r.pointCards){for(let d of i.attachedJacks){let h=this.getJackController(i,d);this.isProtected(h,d.id)||s.push(`seven_oneoff:${e.id}:card:${d.id}`)}this.config.variant!=="standard"&&(this.isProtected(i.controller,i.card.id)||s.push(`seven_oneoff:${e.id}:card:${i.card.id}`))}}break}switch(e.rank){case"8":case"Q":case"K":s.push(`seven_permanent:${e.id}`);break;case"J":for(let r of this.state.players)for(let a of r.pointCards)this.isProtected(a.controller,a.card.id)||s.push(`seven_permanent:${e.id}:${a.card.id}`);break}if(y(e.rank))for(let r of this.state.players)for(let a of r.pointCards)a.controller===1-t&&C(e,a.card)&&s.push(`seven_scuttle:${e.id}:${a.card.id}`);return s}getAllPointCardsInPlay(){let t=[];for(let e of this.state.players)t.push(...e.pointCards);return t}getAllPermanentsInPlay(){let t=[];for(let e of this.state.players)t.push(...e.permanents);for(let e of this.state.players)for(let s of e.pointCards)for(let n of s.attachedJacks)t.push({card:n,type:"joker"});return t}getJackController(t,e){let s=t.attachedJacks.indexOf(e);return(this.findCardOriginalOwner(t.card.id)+s+1)%2}findCardOriginalOwner(t){for(let e=0;e<this.state.players.length;e++)if(this.state.players[e].pointCards.some(s=>s.card.id===t))return e;return 0}action(t,e){if(!this.getValidActions(t).includes(e))return{success:!1,message:`Invalid action: ${e}`};let n=e.split(":"),r=n[0],a="";switch(this.state.consecutivePasses=r==="pass"?this.state.consecutivePasses+1:0,this.state.phase){case"play":a=this.handlePlayPhase(t,r,n);break;case"counter":a=this.handleCounterPhase(t,r,n);break;case"resolve_three":a=this.handleResolveThree(t,n);break;case"resolve_four":a=this.handleResolveFour(t,n);break;case"resolve_five_discard":a=this.handleResolveFiveDiscard(t,n);break;case"resolve_seven":a=this.handleResolveSeven(t,r,n);break;case"resolve_seven_choose":a=this.handleResolveSevenChoose(t,r,n);break}return this.state.lastAction=a,this.checkGameEnd(),{success:!0,message:a}}handlePlayPhase(t,e,s){switch(e){case"draw":let n=this.state.deck.pop();return this.state.players[t].hand.push(n),this.advanceTurn(),`Player ${t} draws a card`;case"pass":return this.state.consecutivePasses>=3?(this.state.isDraw=!0,this.state.phase="complete","Game ends in a draw (3 consecutive passes)"):(this.advanceTurn(),`Player ${t} passes`);case"point":{let r=parseInt(s[1]),a=this.removeCardFromHand(t,r);return this.state.players[t].pointCards.push({card:a,attachedJacks:[],controller:t}),this.advanceTurn(),`Player ${t} plays ${f(a)} for ${b(a.rank)} points`}case"oneoff":{let r=parseInt(s[1]),a=this.removeCardFromHand(t,r),i,d;return s.length>3&&s[2]!=="target"&&(i={cardId:parseInt(s[3]),type:s[2]}),s.length>2&&s[2]==="target"&&(d=parseInt(s[3])),this.state.pendingOneOff={card:a,player:t,target:i,targetPlayer:d,counterChain:[]},this.state.phase="counter",`Player ${t} plays ${f(a)} as one-off`}case"permanent":{let r=parseInt(s[1]),a=this.removeCardFromHand(t,r);if(a.rank==="J"){let i=parseInt(s[2]),d=this.findPointCard(i);return d&&(d.attachedJacks.push(a),d.controller=t),this.advanceTurn(),`Player ${t} plays ${f(a)} on point card`}else{let i=a.rank==="8"?"eight":a.rank==="Q"?"queen":"king";return this.state.players[t].permanents.push({card:a,type:i}),this.advanceTurn(),`Player ${t} plays ${f(a)} as permanent`}}case"scuttle":{let r=parseInt(s[1]),a=parseInt(s[2]),i=this.removeCardFromHand(t,r),d=this.findPointCard(a);return d&&(this.removePointCard(a),this.state.scrap.push(i,d.card,...d.attachedJacks)),this.advanceTurn(),`Player ${t} scuttles with ${f(i)}`}case"joker":{let r=parseInt(s[1]),a=parseInt(s[2]),i=this.removeCardFromHand(t,r);for(let d=0;d<this.state.players.length;d++){if(d===t)continue;let h=this.state.players[d].permanents.findIndex(o=>o.card.id===a);if(h>=0){let o=this.state.players[d].permanents.splice(h,1)[0];return this.state.players[t].permanents.push({card:o.card,type:o.type,stolenFromPlayer:d}),this.state.scrap.push(i),this.advanceTurn(),`Player ${t} uses Joker to steal ${f(o.card)} from Player ${d}`}for(let o of this.state.players[d].pointCards){let c=o.attachedJacks.findIndex(l=>l.id===a);if(c>=0){let l=o.attachedJacks.splice(c,1)[0];this.state.players[t].hand.push(l);let u=d;return o.controller=o.attachedJacks.length%2===0?u:1-u,this.state.scrap.push(i),this.advanceTurn(),`Player ${t} uses Joker to steal ${f(l)} from Player ${d}`}}}return this.advanceTurn(),`Player ${t} plays Joker (no valid target found)`}default:return"Unknown action"}}handleCounterPhase(t,e,s){if(!this.state.pendingOneOff)return"No pending one-off";if(e==="pass")return this.state.pendingOneOff.counterChain.length%2===0?this.resolveOneOff():(this.state.scrap.push(this.state.pendingOneOff.card,...this.state.pendingOneOff.counterChain),this.state.pendingOneOff=null,this.state.phase="play",this.advanceTurn(),"One-off was countered");if(e==="counter"){let n=parseInt(s[1]),r=this.removeCardFromHand(t,n);return this.state.pendingOneOff.counterChain.push(r),`Player ${t} counters with ${f(r)}`}return"Unknown counter action"}resolveOneOff(){let t=this.state.pendingOneOff,e=t.player,s=t.card;this.state.scrap.push(s,...t.counterChain);let n="";switch(s.rank){case"A":for(let r of this.state.players){for(let a of r.pointCards)this.state.scrap.push(a.card,...a.attachedJacks);r.pointCards=[]}n="All point cards moved to scrap",this.state.phase="play",this.advanceTurn();break;case"2":t.target&&this.removePermanent(t.target.cardId),n="Permanent destroyed",this.state.phase="play",this.advanceTurn();break;case"3":this.state.phase="resolve_three",n="Choose a card from scrap";break;case"4":{let r=t.targetPlayer!==void 0?t.targetPlayer:1-e,a=this.state.players[r];this.state.discardCount=Math.min(2,a.hand.length),this.state.discardingPlayer=r,this.state.discardCount>0?(this.state.phase="resolve_four",n=`Player ${r} must discard ${this.state.discardCount} cards`):(this.state.phase="play",this.state.discardingPlayer=null,this.advanceTurn(),n=`Player ${r} has no cards to discard`);break}case"5":if(this.config.variant!=="classic")if(this.state.players[e].hand.length===0){let a=Math.min(3,this.state.deck.length);for(let i=0;i<a;i++)this.state.players[e].hand.push(this.state.deck.pop());n=`Player ${e} draws ${a} cards`,this.state.phase="play",this.advanceTurn()}else this.state.fiveDiscardPending=!0,this.state.phase="resolve_five_discard",n=`Player ${e} must discard a card, then draws 3`;else{let r=Math.min(2,this.state.deck.length);for(let a=0;a<r;a++)this.state.players[e].hand.push(this.state.deck.pop());n=`Player ${e} draws ${r} cards`,this.state.phase="play",this.advanceTurn()}break;case"6":for(let r of this.state.players){for(let a of r.permanents)this.state.scrap.push(a.card);r.permanents=[];for(let a of r.pointCards)this.state.scrap.push(...a.attachedJacks),a.attachedJacks=[],a.controller=this.state.players.indexOf(r)}n="All permanents moved to scrap",this.state.phase="play",this.advanceTurn();break;case"7":if(this.config.variant!=="classic")if(this.state.deck.length>=2){let r=this.state.deck.pop(),a=this.state.deck.pop();this.state.sevenRevealedCards=[r,a],this.state.phase="resolve_seven_choose",n=`Player ${e} reveals ${f(r)} and ${f(a)} - choose one to play`}else if(this.state.deck.length===1){let r=this.state.deck.pop();this.state.sevenDrawnCard=r,this.state.phase="resolve_seven",n=`Player ${e} draws ${f(r)} and must play it`}else this.state.phase="play",this.advanceTurn(),n="Deck is empty";else if(this.state.deck.length>0){let r=this.state.deck.pop();this.state.sevenDrawnCard=r,this.state.phase="resolve_seven",n=`Player ${e} draws ${f(r)} and must play it`}else this.state.phase="play",this.advanceTurn(),n="Deck is empty";break;case"9":{if(t.target){let r=t.target.cardId,a=null;for(let i=0;i<this.state.players.length;i++){let d=this.state.players[i];if(d.permanents.some(h=>h.card.id===r)){a=i;break}for(let h of d.pointCards)if(h.card.id===r||h.attachedJacks.some(o=>o.id===r)){a=i;break}if(a!==null)break}this.returnCardToHand(r),this.config.variant!=="classic"&&this.state.frozenCardIds.push(r),this.config.variant==="cutthroat"&&a!==null&&a!==e&&(this.state.skipTurnPlayers.includes(a)||this.state.skipTurnPlayers.push(a))}this.config.variant==="cutthroat"?n="Permanent returned to hand (frozen + owner skips next turn)":this.config.variant==="standard"?n="Permanent returned to hand (frozen until next turn)":n="Card returned to hand",this.state.phase="play",this.advanceTurn();break}}return this.state.pendingOneOff=null,n}handleResolveThree(t,e){let s=parseInt(e[1]),n=this.state.scrap.findIndex(r=>r.id===s);if(n>=0){let r=this.state.scrap.splice(n,1)[0];this.state.players[t].hand.push(r)}return this.state.phase="play",this.advanceTurn(),`Player ${t} retrieves card from scrap`}handleResolveFour(t,e){let s=parseInt(e[1]),n=this.removeCardFromHand(t,s);return this.state.scrap.push(n),this.state.discardCount--,this.state.discardCount===0||this.state.players[t].hand.length===0?(this.state.phase="play",this.state.discardingPlayer=null,this.advanceTurn(),`Player ${t} finishes discarding`):`Player ${t} discards ${f(n)}`}handleResolveFiveDiscard(t,e){let s=parseInt(e[1]),n=this.removeCardFromHand(t,s);this.state.scrap.push(n);let r=0,a=Math.min(3,this.state.deck.length);for(let i=0;i<a;i++)this.state.players[t].hand.length<this.config.handLimit&&(this.state.players[t].hand.push(this.state.deck.pop()),r++);return this.state.fiveDiscardPending=!1,this.state.phase="play",this.advanceTurn(),`Player ${t} discards ${f(n)}, draws ${r} cards`}handleResolveSeven(t,e,s){let n=this.state.sevenDrawnCard;if(this.state.sevenDrawnCard=null,e==="scrap_seven")return this.state.scrap.push(n),this.state.phase="play",this.advanceTurn(),"Card scrapped (could not be played)";switch(e.replace("seven_","")){case"point":this.state.players[t].pointCards.push({card:n,attachedJacks:[],controller:t});break;case"oneoff":{let a=s.length>3?{cardId:parseInt(s[3]),type:s[2]}:void 0;return this.state.pendingOneOff={card:n,player:t,target:a,counterChain:[]},this.state.phase="counter",`Player ${t} plays ${f(n)} as one-off from 7`}case"permanent":{if(n.rank==="J"){let a=parseInt(s[2]),i=this.findPointCard(a);i&&(i.attachedJacks.push(n),i.controller=t)}else{let a=n.rank==="8"?"eight":n.rank==="Q"?"queen":"king";this.state.players[t].permanents.push({card:n,type:a})}break}case"scuttle":{let a=parseInt(s[2]),i=this.findPointCard(a);i&&(this.removePointCard(a),this.state.scrap.push(n,i.card,...i.attachedJacks));break}case"joker":{let a=parseInt(s[2]);for(let i=0;i<this.state.players.length;i++){if(i===t)continue;let d=this.state.players[i].permanents.findIndex(h=>h.card.id===a);if(d>=0){let h=this.state.players[i].permanents.splice(d,1)[0];return this.state.players[t].permanents.push({card:h.card,type:h.type,stolenFromPlayer:i}),this.state.scrap.push(n),this.state.phase="play",this.advanceTurn(),`Player ${t} uses Joker from 7 to steal ${f(h.card)} from Player ${i}`}for(let h of this.state.players[i].pointCards){let o=h.attachedJacks.findIndex(c=>c.id===a);if(o>=0){let c=h.attachedJacks.splice(o,1)[0];this.state.players[t].hand.push(c);let l=i;return h.controller=h.attachedJacks.length%2===0?l:1-l,this.state.scrap.push(n),this.state.phase="play",this.advanceTurn(),`Player ${t} uses Joker from 7 to steal ${f(c)} from Player ${i}`}}}this.state.scrap.push(n);break}}return this.state.phase="play",this.advanceTurn(),`Player ${t} plays ${f(n)} from 7`}handleResolveSevenChoose(t,e,s){if(!this.state.sevenRevealedCards||this.state.sevenRevealedCards.length===0)return"No cards to choose from";if(e==="scrap_seven"){let h=parseInt(s[1]),o=this.state.sevenRevealedCards.findIndex(c=>c.id===h);if(o>=0){let c=this.state.sevenRevealedCards.splice(o,1)[0];this.state.scrap.push(c),this.state.sevenRevealedCards.length>0&&this.state.deck.push(this.state.sevenRevealedCards[0])}return this.state.sevenRevealedCards=null,this.state.phase="play",this.advanceTurn(),"Card scrapped (could not be played)"}let n=e.replace("seven_",""),r=parseInt(s[1]),a=this.state.sevenRevealedCards.findIndex(h=>h.id===r);if(a<0)return"Invalid card choice";let i=this.state.sevenRevealedCards[a],d=this.state.sevenRevealedCards[1-a];switch(d&&this.state.deck.push(d),this.state.sevenRevealedCards=null,n){case"point":this.state.players[t].pointCards.push({card:i,attachedJacks:[],controller:t});break;case"oneoff":{let h=s.length>3?{cardId:parseInt(s[3]),type:s[2]}:void 0;return this.state.pendingOneOff={card:i,player:t,target:h,counterChain:[]},this.state.phase="counter",`Player ${t} plays ${f(i)} as one-off from 7`}case"permanent":{if(i.rank==="J"){let h=parseInt(s[2]),o=this.findPointCard(h);o&&(o.attachedJacks.push(i),o.controller=t)}else{let h=i.rank==="8"?"eight":i.rank==="Q"?"queen":"king";this.state.players[t].permanents.push({card:i,type:h})}break}case"scuttle":{let h=parseInt(s[2]),o=this.findPointCard(h);o&&(this.removePointCard(h),this.state.scrap.push(i,o.card,...o.attachedJacks));break}case"joker":{let h=parseInt(s[2]);for(let o=0;o<this.state.players.length;o++){if(o===t)continue;let c=this.state.players[o].permanents.findIndex(l=>l.card.id===h);if(c>=0){let l=this.state.players[o].permanents.splice(c,1)[0];return this.state.players[t].permanents.push({card:l.card,type:l.type,stolenFromPlayer:o}),this.state.scrap.push(i),this.state.phase="play",this.advanceTurn(),`Player ${t} uses Joker from 7 to steal ${f(l.card)} from Player ${o}`}for(let l of this.state.players[o].pointCards){let u=l.attachedJacks.findIndex(g=>g.id===h);if(u>=0){let g=l.attachedJacks.splice(u,1)[0];this.state.players[t].hand.push(g);let k=o;return l.controller=l.attachedJacks.length%2===0?k:1-k,this.state.scrap.push(i),this.state.phase="play",this.advanceTurn(),`Player ${t} uses Joker from 7 to steal ${f(g)} from Player ${o}`}}}this.state.scrap.push(i);break}}return this.state.phase="play",this.advanceTurn(),`Player ${t} plays ${f(i)} from 7`}removeCardFromHand(t,e){let s=this.state.players[t].hand,n=s.findIndex(r=>r.id===e);if(n>=0)return s.splice(n,1)[0]}findPointCard(t){for(let e of this.state.players)for(let s of e.pointCards)if(s.card.id===t)return s}findCardOwner(t){for(let e=0;e<this.state.players.length;e++){let s=this.state.players[e];for(let n of s.permanents)if(n.card.id===t)return e;for(let n of s.pointCards){if(n.card.id===t)return e;for(let r of n.attachedJacks)if(r.id===t)return n.controller}}return-1}removePointCard(t){for(let e of this.state.players){let s=e.pointCards.findIndex(n=>n.card.id===t);if(s>=0){e.pointCards.splice(s,1);return}}}removePermanent(t){for(let e of this.state.players){let s=e.permanents.findIndex(n=>n.card.id===t);if(s>=0){let n=e.permanents.splice(s,1)[0];this.state.scrap.push(n.card);return}}for(let e of this.state.players)for(let s of e.pointCards){let n=s.attachedJacks.findIndex(r=>r.id===t);if(n>=0){let r=s.attachedJacks.splice(n,1)[0];this.state.scrap.push(r);let a=this.state.players.indexOf(e);s.controller=s.attachedJacks.length%2===0?a:1-a;return}}}returnCardToHand(t){for(let e=0;e<this.state.players.length;e++){let s=this.state.players[e],n=s.permanents.findIndex(r=>r.card.id===t);if(n>=0){let r=s.permanents.splice(n,1)[0];s.hand.push(r.card);return}}for(let e=0;e<this.state.players.length;e++){let s=this.state.players[e],n=s.pointCards.findIndex(r=>r.card.id===t);if(n>=0){let r=s.pointCards.splice(n,1)[0];s.hand.push(r.card),this.state.scrap.push(...r.attachedJacks);return}}for(let e of this.state.players)for(let s of e.pointCards){let n=s.attachedJacks.findIndex(r=>r.id===t);if(n>=0){let r=s.attachedJacks.splice(n,1)[0],a=(this.state.players.indexOf(e)+n+1)%2;this.state.players[a].hand.push(r);let i=this.state.players.indexOf(e);s.controller=s.attachedJacks.length%2===0?i:1-i;return}}}advanceTurn(){this.state.turnNumber++;let t=this.state.players.length,e=(this.state.currentPlayer+1)%t,s=0;for(;this.state.skipTurnPlayers.includes(e)&&s<t;)this.state.skipTurnPlayers=this.state.skipTurnPlayers.filter(n=>n!==e),e=(e+1)%t,s++;if(this.state.currentPlayer=e,this.state.discardingPlayer=null,this.config.variant!=="classic"&&this.state.frozenCardIds.length>0){let n=this.state.currentPlayer,r=this.state.players[n].hand,a=new Set(r.map(i=>i.id));this.state.frozenCardIds=this.state.frozenCardIds.filter(i=>!a.has(i))}}checkGameEnd(){if(this.state.phase==="complete")return;let t=this.state.players.length,e=t===2?3:t;if(this.state.consecutivePasses>=e){this.state.isDraw=!0,this.state.phase="complete";return}for(let s=0;s<t;s++){let n=this.getPoints(s),r=this.getPointGoal(s);if(r===0){this.state.winner=s,this.state.phase="complete";return}if(n>=r){this.state.winner=s,this.state.phase="complete";return}}}render(){console.log(`
`+"=".repeat(60)),console.log(`CUTTLE (${this.config.variant})`),console.log("=".repeat(60)),console.log(`Turn: ${this.state.turnNumber} | Phase: ${this.state.phase}`),console.log(`Current player: ${this.state.currentPlayer}`),console.log(`Deck: ${this.state.deck.length} cards | Scrap: ${this.state.scrap.length} cards`);for(let t=0;t<this.state.players.length;t++){let e=this.state.players[t],s=t===this.state.currentPlayer?"-> ":"   ",n=this.getPoints(t),r=this.getPointGoal(t),a=this.state.skipTurnPlayers.includes(t)?" [SKIP]":"";console.log(`
${s}Player ${t}: ${n}/${r} points${a}`),console.log(`   Hand (${e.hand.length}): ${e.hand.map(i=>i.isJoker?"\u{1F0CF}":f(i)).join(" ")}`),console.log(`   Points: ${e.pointCards.filter(i=>i.controller===t).map(i=>f(i.card)+(i.attachedJacks.length>0?`(J\xD7${i.attachedJacks.length})`:"")).join(" ")}`),console.log(`   Permanents: ${e.permanents.map(i=>i.card.isJoker?"\u{1F0CF}":f(i.card)).join(" ")}`)}this.state.lastAction&&console.log(`
Last: ${this.state.lastAction}`),this.state.winner!==null&&console.log(`
*** PLAYER ${this.state.winner} WINS ***`),this.state.isDraw&&console.log(`
*** GAME IS A DRAW ***`)}};function j(){return 500}export{O as CuttleGame,J as RANKS,T as SUITS,j as getMaxActionSpaceSize};
