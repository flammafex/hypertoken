<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="#e94560">
  <meta name="description" content="A strategic two-player card game of combat and cunning">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Cuttle">
  <title>Cuttle - Card Game</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="favicon.ico" sizes="any">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">
</head>
<body>
  <div id="app" role="application" aria-label="Cuttle Card Game">
    <!-- Screen reader announcements -->
    <div id="sr-announcements" class="sr-only" aria-live="polite" aria-atomic="true"></div>

    <!-- Header -->
    <header id="header">
      <h1 id="logo" tabindex="0" role="button" aria-label="Pause game">‚öîÔ∏è Cuttle</h1>
      <div id="game-info" aria-label="Game status">
        <span id="variant-label" tabindex="0" role="button" aria-label="View rules">Classic</span>
        <span id="timer" aria-label="Time elapsed">0:00</span>
        <span id="deck-info" aria-label="Cards remaining in deck">Deck: 52</span>
      </div>
    </header>

    <!-- Main game area -->
    <main id="game-area" aria-label="Game board">
      <!-- Opponents container (dynamically populated) -->
      <div id="opponents-container" role="region" aria-label="Opponent areas"></div>

      <!-- Center area: one-off zone + seven zone + deck + scrap -->
      <section id="center-area" aria-label="Central play area">
        <!-- Phase announcement banner -->
        <div id="phase-banner" class="phase-banner hidden" role="alert" aria-live="assertive"></div>
        <div id="oneoff-zone" class="oneoff-zone hidden" role="region" aria-label="Pending one-off cards">
          <div class="oneoff-label">One-Off</div>
          <div id="oneoff-cards" class="oneoff-cards"></div>
        </div>
        <div id="seven-zone" class="seven-zone hidden" role="region" aria-label="Seven effect cards">
          <div class="seven-label">Play from 7</div>
          <div id="seven-cards" class="seven-cards"></div>
        </div>
        <div class="center-row">
          <div id="deck" class="card card-sprite card-back sprite-back" title="Draw a card" tabindex="0" role="button" aria-label="Draw deck, 52 cards remaining. Press to draw a card.">
            <span class="deck-count" aria-hidden="true">52</span>
          </div>
          <div id="scrap" class="scrap-pile" tabindex="0" role="button" aria-label="Scrap pile. Press to view discarded cards.">
            <div class="scrap-label" aria-hidden="true">Scrap</div>
            <div id="scrap-top" class="card empty"></div>
          </div>
        </div>
      </section>

      <!-- Your area + Partner (in Team variant) -->
      <section id="your-section" role="region" aria-label="Your cards">
        <div id="your-area" class="player-area">
          <div class="player-header">
            <span class="player-name">üéÆ You</span>
            <span id="your-points-display" class="player-points" aria-label="Your score">0/21</span>
            <span id="turn-indicator" class="turn-indicator hidden" role="status" aria-live="polite">YOUR TURN</span>
          </div>
          <div class="card-row">
            <label id="perm-label">Permanents:</label>
            <div id="your-permanents" class="permanents" role="list" aria-labelledby="perm-label"></div>
          </div>
          <div class="card-row">
            <label id="points-label">Points:</label>
            <div id="your-points" class="point-cards" role="list" aria-labelledby="points-label"></div>
          </div>
          <div class="card-row">
            <label id="hand-label">Hand:</label>
            <div id="your-hand" class="hand your-hand" role="listbox" aria-labelledby="hand-label" aria-describedby="hand-instructions"></div>
            <span id="hand-instructions" class="sr-only">Use number keys 1-8 to select cards, Space to draw, P to pass</span>
          </div>
        </div>
        <!-- Partner area (shown in Team variant) -->
        <div id="partner-area" class="player-area teammate hidden" role="region" aria-label="Partner's cards"></div>
      </section>
    </main>

    <!-- Floating card preview tooltip -->
    <div id="card-preview" class="card-preview">
      <div id="preview-card" class="preview-card-slot"></div>
      <div id="preview-info" class="preview-info">
        <div id="preview-type" class="preview-type"></div>
        <div id="preview-desc" class="preview-desc"></div>
      </div>
    </div>

    <!-- Action panel -->
    <aside id="action-panel" class="hidden" role="dialog" aria-labelledby="action-panel-title" aria-modal="false">
      <h3 id="action-panel-title">Choose Action</h3>
      <div id="action-buttons" role="group" aria-label="Available actions"></div>
      <button id="cancel-action" class="btn-secondary">Cancel</button>
    </aside>

    <!-- Scrap browser modal -->
    <div id="scrap-modal" class="modal hidden" role="dialog" aria-labelledby="scrap-modal-title" aria-modal="true">
      <div class="modal-content scrap-content">
        <h2 id="scrap-modal-title">Scrap Pile</h2>
        <p id="scrap-instruction">Click a card to retrieve it.</p>
        <div id="scrap-cards" class="scrap-browser" role="listbox" aria-label="Cards in scrap pile"></div>
        <button id="close-scrap" class="btn-secondary">Close</button>
      </div>
    </div>

    <!-- Status/message area -->
    <footer id="status-bar" role="region" aria-label="Game status">
      <div id="message" role="status" aria-live="polite">Welcome to Cuttle! Click a card to play.</div>
      <button id="pass-btn" class="btn-secondary hidden" aria-label="Pass turn">Pass</button>
      <div id="chronicle-header" aria-hidden="true">üìú Chronicle</div>
      <div id="move-history" role="log" aria-label="Move history" aria-live="polite"></div>
    </footer>

    <!-- Start screen -->
    <div id="start-screen" class="modal" role="dialog" aria-labelledby="start-title" aria-modal="true">
      <div class="modal-content">
        <h2 id="start-title">‚öîÔ∏è Cuttle</h2>
        <p>A combat card game</p>
        <div class="variant-select">
          <label for="variant-select">Variant:</label>
          <select id="variant-select">
            <option value="classic">Classic (2 players)</option>
            <option value="standard">Standard (2 players)</option>
            <option value="cutthroat">Cutthroat (3 players)</option>
            <option value="team">Team Cuttle (2v2)</option>
          </select>
        </div>
        <button id="start-game" class="btn-primary">Start Game vs AI</button>
        <button id="start-multiplayer" class="btn-primary">Play Online</button>
        <button id="show-rules" class="btn-secondary">View Classic Rules</button>
      </div>
    </div>

    <!-- Multiplayer lobby modal -->
    <div id="multiplayer-lobby" class="modal hidden" role="dialog" aria-labelledby="lobby-title" aria-modal="true">
      <div class="modal-content">
        <h2 id="lobby-title">‚öîÔ∏è Multiplayer</h2>
        <div id="lobby-connecting" class="lobby-status" role="status" aria-live="polite">
          <p>Connecting to server...</p>
        </div>

        <!-- Room selection (create/join) -->
        <div id="lobby-room-select" class="lobby-status hidden">
          <p>Create a new game or join an existing one:</p>
          <div class="room-actions">
            <button id="create-room-btn" class="btn-primary">Create Room</button>
          </div>
          <div class="room-join">
            <label for="room-code-input">Or enter room code:</label>
            <div class="room-code-input-group">
              <input type="text" id="room-code-input" placeholder="ABCD-1234" maxlength="9" autocomplete="off">
              <button id="join-room-btn" class="btn-secondary">Join</button>
            </div>
          </div>
        </div>

        <!-- Room code display (shown when in a room) -->
        <div id="lobby-room-code" class="lobby-status hidden">
          <p>Share this code with your opponent:</p>
          <div class="room-code-display">
            <span id="room-code-text" class="room-code-large">XXXX-XXXX</span>
            <button id="copy-room-code" class="btn-icon" title="Copy code">üìã</button>
          </div>
          <p class="room-link-label">Or share this link:</p>
          <a id="room-link" href="#" class="room-link" target="_blank">Loading...</a>
          <button id="copy-room-link" class="btn-secondary btn-small">Copy Link</button>
        </div>

        <div id="lobby-waiting" class="lobby-status hidden" role="status" aria-live="polite">
          <p id="lobby-status-text">Waiting for opponent...</p>
          <div id="lobby-players" class="lobby-players" role="list" aria-label="Players"></div>
        </div>
        <div id="lobby-error" class="lobby-status hidden" role="alert">
          <p id="lobby-error-text" class="error-text">Connection failed</p>
        </div>
        <div class="server-input" style="display: none;">
          <label for="server-url">Server:</label>
          <input type="text" id="server-url" value="" placeholder="Auto-detected">
        </div>
        <button id="lobby-connect" class="btn-primary hidden">Connect</button>
        <button id="lobby-cancel" class="btn-secondary">Cancel</button>
      </div>
    </div>

    <!-- Rules modal -->
    <div id="rules-modal" class="modal hidden" role="dialog" aria-labelledby="rules-title" aria-modal="true">
      <div class="modal-content rules-content">
        <h2 id="rules-title">Cuttle Rules</h2>
        <div id="rules-text" tabindex="0"></div>
        <button id="close-rules" class="btn-primary">Close</button>
      </div>
    </div>

    <!-- Game over modal -->
    <div id="game-over-modal" class="modal hidden" role="dialog" aria-labelledby="game-over-title" aria-modal="true">
      <div class="modal-content game-over-content">
        <h2 id="game-over-title">Game Over</h2>
        <p id="game-over-message" role="status"></p>
        <div class="game-over-chronicle">
          <h3>üìú Chronicle</h3>
          <div id="game-over-history" class="chronicle-scroll" tabindex="0" role="log" aria-label="Game history"></div>
        </div>
        <button id="play-again" class="btn-primary">Play Again</button>
      </div>
    </div>

    <!-- Pause modal -->
    <div id="pause-modal" class="modal hidden" role="dialog" aria-labelledby="pause-title" aria-modal="true">
      <div class="modal-content">
        <h2 id="pause-title">‚öîÔ∏è Cuttle</h2>
        <p id="pause-game-info" role="status">Game paused</p>
        <div class="variant-select">
          <label for="pause-variant-select">Variant:</label>
          <select id="pause-variant-select">
            <option value="classic">Classic (2 players)</option>
            <option value="standard">Standard (2 players)</option>
            <option value="cutthroat">Cutthroat (3 players)</option>
            <option value="team">Team Cuttle (2v2)</option>
          </select>
        </div>
        <button id="resume-game" class="btn-primary">Resume Game</button>
        <button id="new-game" class="btn-secondary">New Game</button>
        <button id="pause-show-rules" class="btn-secondary">View Rules</button>
      </div>
    </div>
  </div>

  <script type="module" src="cuttle-web.js?v=20241230v17"></script>
  <script>
    // Register service worker for PWA
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js')
          .then((registration) => {
            console.log('ServiceWorker registered:', registration.scope);
          })
          .catch((error) => {
            console.log('ServiceWorker registration failed:', error);
          });
      });
    }
  </script>
</body>
</html>
